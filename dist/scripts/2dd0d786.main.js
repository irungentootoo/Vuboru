var sgnPem=$('[name="sgnkey1"]').val(),key=new window.RSAKey;key.readPrivateKeyFromPEMString(sgnPem);var r,e=key.e,p=key.p,q=key.q,d=key.d,n=p.multiply(q),rng=new SecureRandom,bits=2*n.toString(16).length,eBig=new BigInteger(e.toString(),10);do r=new BigInteger(bits,1,rng);while(0!=r.subtract(BigInteger.ONE).gcd(eBig).compareTo(BigInteger.ONE)||!r.isProbablePrime(10));var r_x64=hex2b64(r.toString(16));$('[name="blindPrime"]').val(linebrk(r_x64,32));var message=new BigInteger(rstr2hex(rstr_sha512($('[name="message"]').val())),16),m=message.multiply(r.modPowInt(e,n)).mod(n),m_x64=hex2b64(m.toString(16));$('[name="blindedSignature"]').val(window.linebrk(m_x64,32)),$('[name="blindedSignatureQR"]').qrcode({size:512,text:m_x64,render:"div",fill:"#3a3",ecLevel:"L"});var s=key.doPrivate(m),s_x64=hex2b64(s.toString(16));$('[name="signedBlindedSignature"]').val(window.linebrk(s_x64,32)),$('[name="signedBlindedSignatureQR"]').qrcode({size:512,text:s_x64,render:"div",fill:"#33a",ecLevel:"L"});var signature=s.multiply(r.modInverse(n)).mod(n),signature_x64=hex2b64(signature.toString(16)),vote="Голос:\r\n"+$('[name="message"]').val()+"\r\n\r\nПідпис:\r\n"+linebrk(signature_x64,32);$('[name="unblindedSignedBlindedSignature"]').val(vote),$('[name="unblindedSignedBlindedSignatureQR"]').qrcode({size:512,text:vote,render:"div",fill:"#a33",ecLevel:"L"});